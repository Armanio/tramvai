# State

**State** - встроенная в `tramvai` библиотека для управления состоянием приложения.

## Особенности

- Redux-like стейт-менеджер
- Встроенная библиотека, похожая на [redux-act](https://github.com/pauldijou/redux-act), для уменьшения boilerplate кода
- Содержит привязки к `react` компонентам, такие как `connect` и `useSelector`
- Динамическая инициализация редьюсеров. Можно в любое время зарегистрировать редьюсер или сгенерировать новый.
- Точечные подписки на изменения состояний редьюсеров. При изменении данных повторно пересчитываются только затронутые `connect` и `useSelector`, а не все.
- Поддержка SSR режима.

## Основные концепции

- Стор - Класс, который содержит состояние всех редьюсеров, подписки на изменения и создается для каждого клиента
- Редьюсеры - сущности в которых мы описываем то, как будут храниться и преобразовываться данные
- Эвенты - события, с помощью которых можно изменить состояния редьюсеров
- Экшены - функции, которые позволяют выполнять сайд-эффекты и обновлять данные в сторе. Похожи на `redux-thunk`

## Рекомендации

- Нельзя мутировать данные в редьюсерах. Иначе из-за различных оптимизаций не произойдёт оповещение подписчиков о изменениях
- Инициализировать редьюсеры как можно раньше и до его использования. Иначе при вызове `dispatch(userLoadInformation())` редьюсер еще не будет отслеживать события и не получит данные.
- Не хранить статичные данные в сторах. Так как эти данные будут передаваться с сервера на клиент, то данные задублируются. Лучше вынести в константы.
- Разбивать на небольшие редьюсеры. Иначе у нас появляется огромный редьюсер, который содержит большое количество информации и любые изменения будут вызывать перерасчеты для большого количества компонентов.

## Установка

```bash
npm i --save @tramvai/state
```

## Базовый пример

```tsx
import { createReducer, createEvent } from '@tramvai/state';

export const userLoadInformation = createEvent('user load information');
export const userAddInformation = createEvent('user add information');

const userReducer = createReducer('user', {
  info: {},
})
  .on(userLoadInformation, (state, info) => ({ info }))
  .on(userAddInformation, (state, { name, info }) => ({
    ...state,
    state: {
      ...state.info,
      [name]: info,
    },
  }));
```
