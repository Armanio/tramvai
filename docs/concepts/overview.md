---
id: overview
title: Введение в tramvai
---

`tramvai` это легковесный веб-фреймворк для создания SSR приложений с модульной системой и DI для возможности быстрого расширения функциональности приложений.

## Основные особенности

- **Модульный подход** - можно расширять функционал приложений с помощью модулей
- **Universal** - Работает одинаково хорошо для браузеров и сервера
- **Быстрый** - имеет малый вес, не оказывает влияния на общую производительность приложения, максимально распараллеливает действия на сервере

## Используемые подходы

![tramvai main](/img/tramvai/tramvai-main.jpg)

### Модульность

Архитектура `tramvai` строится на идее, что у нас весь функционал разделен на различные модули и все общение между модулями строится на общих интерфейсах, взаимодействуя через `DI`. Такая архитектура дает возможность легко добавлять новую функциональность в приложение, и заменять уже существующий функционал.

### Стандартизация

`tramvai` дает основу которая позволяет поддерживать и создавать приложения с одинаковой архитектурой для множества команд с возможностью шарить код между проектами, так как `tramvai` это легковесный слой, который помогает взаимодействовать различными модулям в приложении

### Скорость

Ядро `tramvai` вместе с `DI` весит 4 кб, всё остальное реализуется через сторонние модули, который расширяют функционал приложения. Это дает возможность делать приложения минимального размера, исключая ненужные фичи. Архитектура и модули разработаны с концепцией `performance first` для максимальной параллелизации, согласно `best practice`.

### Универсальность

`tramvai` это SSR-first фреймворк и учитывает все особенности и проблемы, связанные с сервером, клиентом и взаимодействием между ними:

- Все модули разрабатываются и для браузера и для сервера
- Используются общие интерфейсы
- Используется [цепочка команд](concepts/command-line-runner.md) на сервере и браузере которая позволяет выполнять действия в определение время жизни приложения
- [Cистема экшенов](concepts/action.md) позволяет одинаково запрашивать данные на сервере и в браузере, используя различные фичи (e.g. повторение в браузере экшена, упавшего на сервере)

### Разбиение на внешние библиотеки

При разработке `tramvai` стараемся использовать уже готовые решения, либо создавать базовые библиотеки, которые никак не связаны с `tramvai` и могут использовать в других проектах и фреймворках.

### DI с интерфейсом взятым с Nest или Angular DI

`DI` это основа `tramvai` позволяющая уменьшить связанность кода и разделение функциональности на модули. Внутри `tramvai` используется библиотека `dippy` которая реализует `DI` составляющую. Внутренний интерфейс `DI` повторяет интерфейс `Nest`, который позволяет удобно описать зависимости и реализации классов.

### Возможность мягкого перехода

На www.tinkoff.ru уже было написано миллион+ строк кода и новое решение не должно было ломать имеющийся код, а также требовать от приложений тяжелого и долгого перехода

## Почему был разработан:

### tramvai

Зачастую React приложения — это конструктор из разных библиотек, которые были подключены в проект. Это хорошо работает на маленьких масштабах, но плохо работает для больших приложений, где работают 70+ разработчиков, так как в таком подходе легко подключить свое и разойтись кардинально в архитектуре приложений. Эту проблему берет на себя `tramvai` и стандартизирует и реализует общую архитектуру приложений которую используют все продуктовые команды.

На github можно найти не так много open source решений, которые реализуют архитектуру больших приложений.

#### Альтернативы

##### next.js

Один из самых лучших простых фреймворков для React, которые берет на себя проблему с рендерингом приложений на сервере и роутингом. При этом это легковесный фреймворк который никак не стандартизирует и не решает проблемы с модульностью компонентов. Поэтому большинство кода, который был написан на `tramvai` пришлось бы написать для `next.js` и пытаться как-то внедрить, так как в next.js очень ограничена возможность расширения функциональности

##### fusionjs

Похожий фремворк, который развивался и появился в одно и тоже время с `tramvai`. У fusionjs нет полноценного DI, ограниченная возможность вынесения функциональности в модули и вся архитектура построена на основе middlewares, и присутствуют сложности вокруг зашитых приоритетов плагинов и отсутствия параллелизации действий

##### nest.js

Отличный backend фреймворк который использует схожий DI, но полностью не заточен под SSR. И при использовании его, у нас должно было быть 2 архитектуры, одна для бекенда, другая написанная самим под клиент

### dippy

Легковесная DI библиотека с Angular подобным интерфейсом. В открытом доступе нет так много различных вариантов DI которые позволяют разделить реализации классов как базовые общие, так и специфичные для каждого клиента.

#### Альтернативы

##### inversify

Это самая популярная библиотека для создания DI, при этом:

- весит 11кб, в сравнении dippy 1.2кб
- низкоуровневый API который требует различных врапперов для реализации модульной системы.
- `ts-nest` это пример враппера над inversify который имеет слабую поддержку и только враппер содержит примерно столько-же кода как и `dippy`

### state

Встроенная в tramvai [библиотека для управления состоянием](features/state/overview.md) почти полностью схожа интерфейсом с Redux, при этом:

- Позволяет подписывать компоненты только на обновление определенных редьюсеров, решая проблему с перфомансом
- Имеется много кода, написанного с использованием deprecated версии стейта и нельзя просто перейти на другое решение

#### Альтернативы

##### redux

Переход на чистый redux не решит проблемы, а только добавит связанные с performance

##### reatom

Очень похожая на state-management новая библиотека, в которой решена проблема с обновлениями и performance. Хороший кандидат, с которого можно взять некоторые фичи. Полный переход сильно дорог из-за кодовой базы

##### effector

Интересная библиотека, которая имеет фокус на client side и не очень подходит для SSR

## Concepts

### Module

Основные базовые элементы `tramvai` архитектуры которые содержат в себе реализацию функциональности. При этом предполагается, что такие модули не будут огромными и будет появляться большое количество разных видов.

[Документация](concepts/module.md)

### DI система

`tramvai` строится на DI системе которая хранит в себе реализации функциональности и получения реализаций по токенам и ключам. Это позволяет реализовать связи между модулями основываясь только на интерфейсах, при этом имея возможность изменять реализации по необходимости.

[Документация](concepts/di.md)

### CommandLineRunner

Раннер для списка действий, на которые могут навесить действия модули. Списки действий бывают 2 видов:

- Инициализация приложения
- Обработка запроса для клиента

В рамках эти списка действий происходит получение роутов, статуса пользователя, рендеринга страницы и отдачи клиенту html.

[Документация](concepts/command-line-runner.md)

## Диаграммы

### Принцип работы на серверной стороне

![Схема работы приложения на сервере](/img/arch-server.png)
