<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-122261674-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Actions chain | tramvai</title><meta data-react-helmet="true" property="og:url" content="https://tramvai.dev//en/docs/concepts/command-line-runner"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Actions chain | tramvai"><meta data-react-helmet="true" name="description" content="When processing a client request, we need to perform a standard list of actions, such as getting a route, getting the desired data for the client, rendering the application and responding to the client. At the same time, we have a modular system, when the modules do not know about each other, but they need to be connected somehow."><meta data-react-helmet="true" property="og:description" content="When processing a client request, we need to perform a standard list of actions, such as getting a route, getting the desired data for the client, rendering the application and responding to the client. At the same time, we have a modular system, when the modules do not know about each other, but they need to be connected somehow."><link data-react-helmet="true" rel="shortcut icon" href="/en/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://tramvai.dev//en/docs/concepts/command-line-runner"><link data-react-helmet="true" rel="alternate" href="https://tramvai.dev//docs/concepts/command-line-runner" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://tramvai.dev//en/docs/concepts/command-line-runner" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tramvai.dev//docs/concepts/command-line-runner" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.825af2ca.css">
<link rel="preload" href="/en/assets/js/runtime~main.b4a07bcb.js" as="script">
<link rel="preload" href="/en/assets/js/main.25d969cd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><img src="/en/img/logo-tinkoff.svg" alt="tramvai" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/en/img/logo-tinkoff.svg" alt="tramvai" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">tramvai</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/en/docs/get-started/overview">Docs</a><a class="navbar__item navbar__link" href="/en/docs/references/tramvai/create-app">API</a><a href="https://github.com/TinkoffCreditSystems/tramvai" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/concepts/command-line-runner" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">—Ä—É—Å—Å–∫–∏–π</a></li><li><a href="/en/docs/concepts/command-line-runner" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting started</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Concepts</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/concepts/overview">Introduction to tramvai</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/concepts/di">Dependency Injection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/concepts/provider">Provider</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/concepts/module">Module</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/en/docs/concepts/command-line-runner">Actions chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/concepts/action">Action</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/concepts/bundle">Bundle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/concepts/versioning">Versioning</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Features</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">How-to</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Releases</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contribute</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2rXS"><div class="docItemContainer_1EXp"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Actions chain</h1></header><p>When processing a client request, we need to perform a standard list of actions, such as getting a route, getting the desired data for the client, rendering the application and responding to the client. At the same time, we have a modular system, when the modules do not know about each other, but they need to be connected somehow.</p><p>To solve this problem, <code>commandLineRunner</code> was developed, which contains a fixed list of steps in which modules can add the necessary tasks through providers. All steps are executed sequentially, but the tasks registered for each individual step are executed in parallel.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="usage-example"></a>Usage example<a class="hash-link" href="#usage-example" title="Direct link to heading">#</a></h2><p>We have registered a new provider that will be called when <code>commandLineRunner</code> reaches the <code>commandLineListTokens.generatePage</code> token and the <code>render</code> function is executed:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> provide </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@tramvai/core&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">Module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  providers</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">provide</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      provide</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> commandLineListTokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">generatePage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">useFactory</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> responseManager </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          responseManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setBody</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">renderToString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">App</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      deps</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        responseManager</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">RESPONSE_MANAGER_TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      multi</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">RenderModule</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="action-blocks"></a>Action blocks<a class="hash-link" href="#action-blocks" title="Direct link to heading">#</a></h2><p>A number of basic actions are predefined in the tram, which are performed at certain stages of the application. Based on these stages, the work of the basic tram modules is built and actions can be added to custom modules.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initialization-init"></a>Initialization (init)<a class="hash-link" href="#initialization-init" title="Direct link to heading">#</a></h3><p>When tramvai starts, a chain of actions is launched in which you can initialize asynchronous services (if necessary) and add basic functionality. These actions are performed only once and are not available to providers who need a custom context.</p><p><img alt="init command" src="/en/assets/images/command-line-init-03a555026ef72a3e8b1a400a72fc6746.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="handling-customer-requests"></a>Handling customer requests<a class="hash-link" href="#handling-customer-requests" title="Direct link to heading">#</a></h3><p>For each client, we run a list of actions in which the user context and data are available. For each client, we create our own di context in which the implementations will live only while we process the client&#x27;s request.</p><p><img alt="customer command" src="/en/assets/images/customer-command.drawio-01b968dc1bd86174522b7f0be93bc47b.svg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="spa-transitions-spa"></a>SPA transitions (spa)<a class="hash-link" href="#spa-transitions-spa" title="Direct link to heading">#</a></h3><p>For SPA transitions in the browser, routing triggers a list of actions</p><p><img alt="spa command" src="/en/assets/images/command-line-spa-2e224e802651a136dd012000b77a94b2.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="shutdown-close"></a>Shutdown (close)<a class="hash-link" href="#shutdown-close" title="Direct link to heading">#</a></h3><p>Before exiting the application, this list of actions is launched</p><p><img alt="close command" src="/en/assets/images/command-line-close-999a3cc053d7b4ed03d11c5b86b04522.jpg"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tokens"></a>Tokens<a class="hash-link" href="#tokens" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="init"></a>init<a class="hash-link" href="#init" title="Direct link to heading">#</a></h3><p>Initializing Asynchronous Services</p><p><em>For what</em>: If you need to initialize global singletons asynchronously</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="listen"></a>listen<a class="hash-link" href="#listen" title="Direct link to heading">#</a></h3><p>Subscribing to global events by the application</p><p><em>For what</em>: If you need to subscribe to global events or a port</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="customer_start"></a>customer_start<a class="hash-link" href="#customer_start" title="Direct link to heading">#</a></h3><p>The starting token in the client request processing chain. Required to initialize custom asynchronous constructors.</p><p>It is not advised to do any lengthy asynchronous tasks at this stage, as only synchronous actions are expected.</p><p><em>For what</em>: To initialize asynchronous services for each client</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resolve_user_deps"></a>resolve_user_deps<a class="hash-link" href="#resolve_user_deps" title="Direct link to heading">#</a></h3><p>The main goal of this stage is to find out all the necessary information about the client we are currently processing.</p><p>Since all actions within one stage are performed in parallel with us, it is at this stage that you can efficiently and quickly request all the necessary information, for example, simultaneously with the request for customer data, you can find out about the status of the customer&#x27;s authorization, get analytical information about the customer and similar actions.</p><p><em>For what</em>: To request any global customer information</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resolve_page"></a>resolve_page<a class="hash-link" href="#resolve_page" title="Direct link to heading">#</a></h3><p>The main goal of this stage is to find out all the necessary information about the page the client visited.</p><p><em>For what</em>: To request information about the page</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resolve_page_deps"></a>resolve_page_deps<a class="hash-link" href="#resolve_page_deps" title="Direct link to heading">#</a></h3><p>At this stage, we already know about the client, about what this page is. But, we have not requested the necessary data for the page. For example: request resources from the admin panel, get a list of regions, load the necessary page blocks. And all the information that will be needed when generating the page.</p><p>At this stage, it is not worth doing long asynchronous actions and it is supposed to be cached or moved to <code>resolveUserDeps</code> to achieve the maximum speed of response to clients.</p><p>At this stage, <a href="/en/docs/concepts/action">action</a> is executed and perhaps they will suit you better, as there are many additional functionality</p><p><em>For what</em>: To get the information needed to render the page</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="generate_page"></a>generate_page<a class="hash-link" href="#generate_page" title="Direct link to heading">#</a></h3><p>At this stage, we already know the current route, which client and all actions for the page have already been loaded. And at this stage, according to the information from the previous stages, we generate an html page and give it to the client</p><p><em>For what</em>: this is more of an internal stage and should not be used in ordinary cases. Since <a href="https://en.wikipedia.org/wiki/Race_condition" target="_blank" rel="noopener noreferrer">race condition</a> with application rendering</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="clear"></a>clear<a class="hash-link" href="#clear" title="Direct link to heading">#</a></h3><p>This stage will be called after we have responded to the client, but some modules or libraries need to delete client data</p><p><em>For what</em>: The method is needed if you need to perform actions after a successful response to the user</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="spa_transition"></a>spa_transition<a class="hash-link" href="#spa_transition" title="Direct link to heading">#</a></h3><p>Tasks registered at this stage are executed on SPA transitions in the application</p><p><em>For what</em>: To update meta information on the current page</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="close"></a>close<a class="hash-link" href="#close" title="Direct link to heading">#</a></h3><p>Before closing the application, some modules may need to perform special actions, for example, close connections, send data and similar activities. In order not to duplicate the application closure tracking code in each module, this stage was made.</p><p><em>For what</em>: If you need to perform actions before closing the application. for example close connections, send logs and so on</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="customization"></a>Customization<a class="hash-link" href="#customization" title="Direct link to heading">#</a></h2><p>The application can override the standard list of actions, for example, delete unnecessary ones or add new ones.</p><p>To do this, you need to define a provider in the application or module that will rewrite the base list</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> provide </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@tramvai/core&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">provide</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    provide</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">COMMAND_LINES_TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;singleton&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    useValue</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> customLines</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong><em>Caution</em></strong>: do not delete stages, as this may cause some modules to stop working correctly. In this case, the best solution would be to delete the module that is being linked to an unnecessary stage.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/TinkoffCreditSystems/tramvai/-/edit/master/docs/get-started/overview.md/tmp-docs/concepts/command-line-runner.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_1szQ"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/en/docs/concepts/module"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Module</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/en/docs/concepts/action"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Action ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#usage-example" class="table-of-contents__link">Usage example</a></li><li><a href="#action-blocks" class="table-of-contents__link">Action blocks</a><ul><li><a href="#initialization-init" class="table-of-contents__link">Initialization (init)</a></li><li><a href="#handling-customer-requests" class="table-of-contents__link">Handling customer requests</a></li><li><a href="#spa-transitions-spa" class="table-of-contents__link">SPA transitions (spa)</a></li><li><a href="#shutdown-close" class="table-of-contents__link">Shutdown (close)</a></li></ul></li><li><a href="#tokens" class="table-of-contents__link">Tokens</a><ul><li><a href="#init" class="table-of-contents__link">init</a></li><li><a href="#listen" class="table-of-contents__link">listen</a></li><li><a href="#customer_start" class="table-of-contents__link">customer_start</a></li><li><a href="#resolve_user_deps" class="table-of-contents__link">resolve_user_deps</a></li><li><a href="#resolve_page" class="table-of-contents__link">resolve_page</a></li><li><a href="#resolve_page_deps" class="table-of-contents__link">resolve_page_deps</a></li><li><a href="#generate_page" class="table-of-contents__link">generate_page</a></li><li><a href="#clear" class="table-of-contents__link">clear</a></li><li><a href="#spa_transition" class="table-of-contents__link">spa_transition</a></li><li><a href="#close" class="table-of-contents__link">close</a></li></ul></li><li><a href="#customization" class="table-of-contents__link">Customization</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/en/docs/concepts/overview">Architecture</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/get-started/create-app">Getting started</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/references/tramvai/create-app">API reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items"><li class="footer__item"><a href="https://codesandbox.io/s/tramvai-new-qgk90" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Codesandbox<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/TinkoffCreditSystems/tramvai" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/en/img/logo-tinkoff.svg" alt="" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/en/img/logo-tinkoff.svg" alt="" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright ¬© 2021 tinkoff.ru</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.b4a07bcb.js"></script>
<script src="/en/assets/js/main.25d969cd.js"></script>
</body>
</html>